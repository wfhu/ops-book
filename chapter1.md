# 运维能力第一阶段--满足业务需求

---

## 一：满足业务对资源需求的能力

业务对资源的合理需求必须得到满足，保证质量和效率的同时控制好成本。

主要从以下三个方面考虑：

* 效率：同样的资源需求，多久能得到满足，一个月、一个星期、一天或者2小时，对业务部门来说是有质的区别的。

* 质量：给出来的资源质量如何？是否符合预期？前后一致性是否有保障？

* 成本：成本可以增长，但必须是可控的。

### 1.1、选择传统物理IDC

一般有两种模式：

#### 1.1.1、租赁机柜和带宽，自己购买服务器

优势：

* 机器配置和网络架构更加自主可控
* 物理隔离更安全
* 可选择部署地域更广
* 性能可预期
* 上规模时成本有优势

劣势：

* 交付周期长
* 防攻击抵御能力差
* 可伸缩性比较差

#### 1.1.2、直接租赁专有物理服务器

优势：

交付周期相对较短，一般在几小时或者几日内能交付

劣势：

成本偏高

知名的厂商有：Softlayer、RackSpace、NTT等

#### 1.1.3、选择传统物理IDC机房诀窍

**看机房建设标准**

比如国内机房有所谓三星、四星、五星机房，国外有Tier-2，Tier-3，Tier-4等，理论上级别越高机房越可靠。

**看机房地理位置和建筑外形**

优先选择地理位置在郊区、独栋的专业IDC机房，这些一般比处在市中心、高楼大厦中划分某几层用来做IDC的要好。

**选择知名的IDC机房供应商**

比如选择Equinix、Digital Realty、NTT等提供的机房，一般机房本身的品质有保障。

这里可以重点关注一下Equinix机房，他主推的IBX服务，提供高质量的网络互联互通服务。

更多关于IDC选择的标准，可以参考[UptimeInstitute](https://uptimeinstitute.com/)。

#### 1.1.4、选择物理机房的技术准备

远程管理卡和远程管理网络

系统安装服务，如FAI、PXE、Cobbler等

网络上联出口高可用

服务器网卡设置bonding

公网互联互通，考虑出口线路

### 1.2、选择云服务厂商

云服务厂商用得越来越多，我们也可以充分利用其优势和特点，帮助我们支持好业务的运行。

优势：

资源和服务获取速度快

可伸缩性强

技术门槛低

劣势：

安全不可控

性能不可控

排查问题存在黑盒

### 1.3、选择专业的第三方服务供应商

#### 1.3.1、CDN服务

#### 1.3.2、DNS服务

### 1.4、容量（能力）管理

Capacity managememt

容量管理主要需要考虑一下几个方面：

业务预算搜集

资源池管理



-工作案例：

1. 操作系统安装和配置标准化/自动化（kickstart/PXE），云主机模板
2. 开发服务器/CDN常见操作自助功能
3. 物理机房网络和机架调整和优化
4. 物理机房资源池建设和业务预算
5. 迁移业务至云服务商
6. HP/DELL/华为设备采购签订年度框架协议
7. CDN引入Cloudflare
8. 日志分析直接上无服务的架构

## 二：满足业务发布/变更的能力

运维不能成为阻挡业务发布和变更的障碍

1. 效率: 自助操作
2. 质量: 流程化/规范化

### 发布系统

### 持续集成和持续交付

### 作业系统





-工作案例：

1. 开发发布系统，业务自助发布
2. 引入RUNDECK作业系统，固化常用操作，授权业务自己操作
3. 基于k8s/Docker/SVN/Jenkins的测试环境自动持续集成

## 三：快速获取业务相关信息的能力

有异常能发现，平时不出故障，出故障有预案，能快速定位解决

1. 效率: 自助化/可视化/用户体验 基础设施既代码 配置管理 文档

2. 质量: 多维度监控覆盖

3. 屏蔽复杂度，给需要数据的部门/业务，提供统一的获取数据的接口

## 监控和报警系统

### 基础监控

### 系统监控

### 网络监控

### 应用监控

### Statsd

### 业务监控

### 第三方监控

## 日志分析

### ELK系统

## 调用追踪系统

OpenTrace

OpenZipkin





-工作案例：

1. 引入WIKI工具，规范工作文档
2. 引入puppet/saltstack工具维护线上环境配置，环境可重现
3. zabbix/smokeping/prometheus/graphite/grafana多维度监控和可视化
4. 集群基础设施引入CloudFormation/Terraform等工具管理

## 四：满足业务对可用性和稳定性要求的能力

默认一切都是不可靠的，都是会出故障的

（跑的好不好，现在、未来、持久地跑好）

1. 质量: 去单点 故障自愈能力 安全规范和扫描
2. 效率: 预案和演练

架构高可用（去单点）

服务自动恢复

横向可扩展性

安全、可控、可预期

-核心能力/概念

：知识/故障管理，可扩展性，可靠性和运行效率

-工作案例：

1. WEB层全面去单点
2. 引入Docker集群，自动故障漂移/恢复
3. 例行强制重启任意一台业务机，确保高可用能力
4. 引入Nessus/OpenVAS例行扫描，发现对外开放的免密的redis/memcache等

## 五、快速部署和故障恢复的能力

故障演练和预案

基础设施即代码（Infrastructure as Code）

CloudFormation

TerraForm

配置管理工具

系统镜像和模板

备份与恢复

不可变基础设施

